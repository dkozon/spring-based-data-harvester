package net.kozon.dataanalyzer.impl.presentation;

import lombok.extern.slf4j.Slf4j;
import net.kozon.dataanalyzer.interfaces.DataPresentation;
import net.kozon.dataanalyzer.pojo.DataFromSource;
import org.codehaus.plexus.util.xml.CompactXMLWriter;
import org.codehaus.plexus.util.xml.XmlWriterUtil;

import java.io.FileNotFoundException;
import java.io.IOException;
import java.io.PrintWriter;

@Slf4j
public class DataPresentationServiceExploitable implements DataPresentation {


    private static final String XML_INJECTION = "--><div><form action='abc' method='get'><!--\n" +
            "--><input type='tekst'>Jakies inne pole'</input><!--\n" +
            "--><input type='text'>abc</input> </form> </div><!--";

    @Override
    public void presentDataBy(DataFromSource dataFromSource, String outputFile) throws IOException {
        saveToFile(dataFromSource, outputFile);
    }

    @Override
    public void saveToFile(DataFromSource dataFromSource, String outputFile) throws FileNotFoundException {
        PrintWriter printWriter = new PrintWriter(outputFile);
        for (String element: dataFromSource.getSelectors()) {
            printWriter.println("<?xml version=\"1.0\" encoding=\"utf-8\"?>\n" +
                    "<div>" +
                    element +
                    "</div>");
        }
        CompactXMLWriter compactXMLWriter = new CompactXMLWriter(printWriter);
        XmlWriterUtil.writeComment(compactXMLWriter, XML_INJECTION, 0, 0); // podatna metoda
        printWriter.close();
    }
}
